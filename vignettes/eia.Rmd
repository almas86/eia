---
title: "Package overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Package overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, comment = "#>", out.width = "100%",
  message = FALSE, warning = FALSE, error = FALSE
)
library(eia)
options(eia_antidos = 0)
```

This vignette provides a brief overview to the most important functions in `eia`. Other vignettes go into greater depth on specific topics and API endpoints.

## EIA categories

Pulling data from the US Energy Information Administration (EIA) API requires a registered API key. A key can be obtained at no cost [here](https://www.eia.gov/opendata/register.php). A valid email and agreement to the API Terms of Service is required to obtain a key.

Once you have your API key, it is helpful to be aware of various categories of data that are available. Each category has a unique ID number that is required to access associated data. The first call below does not include an ID. The result is a list of two data frames. The first is metadata associated with that position in the category hierarchy. The second is the child category information.

Remember to store your API key somewhere secure. Do not commit it to a repository or otherwise share it. For example, you could store it in your `.Renviron` file.

```{r cats0}
library(eia)
key <- Sys.getenv("EIA_KEY")
```

Here is the top-level category information:

```{r cats1}
eia_cats(key)
```

The child category IDs can be used to query results from that category.

```{r cats2}
eia_cats(key, 0)
```

## EIA time series data

Time series data is obtained by series ID. Most columns contain metadata. The `data` column contains the time series data.

```{r series1}
id <- "ELEC.GEN.ALL-AK-99.A"

(x1 <- eia_series(key, id, n = 5))

x1$data[[1]]
```

You can provide arguments like the following:

```{r series2, eval = FALSE}
eia_series(key, id) # max results
eia_series(key, id, n = 5) # most recent five
eia_series(key, id, end = 2016, n = 5) # ending in 2016
eia_series(key, id, start = 2000, end = 2016) # specific period
```

As with `eia_cats`, the output format does not need to be tidy:

```{r series3, eval = FALSE}
eia_series(key, id, n = 5, tidy = FALSE) # results of jsonlite::fromJSON
eia_series(key, id, n = 5, tidy = NA) # origina JSON as character string
```

This allows you to use the returned results with existing code you may have that requires data in one of these less processed structures.

## EIA geosets

Geosets are metadata structures organizing time series datasets that can be mapped. Arguments to `eia_geoset` are the same as `eia_series` with the addition of `region`. Like `id`, `region` can be a vector. Most of the details are the same as before. 

In the example below using total electricity generation, get the last two data points for each of and two US states. `dplyr` and `tidyr` are used here to clean up the result a bit for purposes of display.

```{r geoset1}
id <- c("ELEC.GEN.ALL-99.A")
region <- c("USA-CA", "USA-NY")
(x <- eia_geoset(key, id, region, n = 2))

library(dplyr)
library(tidyr)
select(x, region, data) %>% unnest()
```

Another convenience of `eia_geoset` is the ability to provide regions in the following forms:

* 2-character US state abbreviations
* State names
* US Census region names
* US census division names

These shortcuts make it easier to construct an API call involving several states:

```{r geoset2}
region <- c("AK", "New England")
(x <- eia_geoset(key, id, region, n = 2))

select(x, region, data) %>% unnest()
```

Even more convenient is that these names are available in R. See the `state.*` functions.
